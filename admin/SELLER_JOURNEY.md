# 판매자 회원 사이트 동선 (Seller Journey)

## 📋 판매자 회원 개요

### 판매자 특징
- **가입 방식**: 직접 가입만 가능 (SNS 가입 불가)
- **역할**: `seller`
- **승인 필요**: 관리자 승인 필수
- **권한 부여**: 게시판별 권한 부여 필요 (알뜰폰/통신사폰/인터넷)

### 판매자 권한 구조
```json
{
  "user_id": "seller001",
  "role": "seller",
  "seller_approved": true,
  "permissions": ["mvno", "mno", "internet"]  // 부여된 권한
}
```

---

## 🔄 판매자 회원가입 및 승인 프로세스

### 1단계: 판매자 가입 신청

```
1. 관리자에게 판매자 가입 요청
   └─> 관리자가 직접 가입 처리
       - 아이디/비밀번호/이메일/이름 입력
       - 역할: seller 선택
       - seller_approved: false (초기값)
       - permissions: [] (빈 배열)
```

**가입 방식:**
- 관리자가 `registerDirectUser()` 함수 사용
- 또는 관리자 페이지에서 직접 생성 (현재 미구현)

### 2단계: 관리자 승인

```
2. 관리자 페이지 접속
   └─> 판매자 승인 관리 (/MVNO/admin/seller-approval.php)
       ├─> 승인 대기 중인 판매자 목록 확인
       └─> "승인" 버튼 클릭
           └─> seller_approved: true
               └─> approved_at: 현재 시간 저장
```

**승인 후 상태:**
- `seller_approved`: `true`
- `approved_at`: 승인 시간 기록
- 하지만 아직 권한은 없음 (빈 배열)

### 3단계: 권한 부여

```
3. 판매자 권한 관리 (/MVNO/admin/seller-permissions.php)
   └─> 승인된 판매자 목록 확인
       └─> 권한 체크박스 선택
           ├─> 알뜰폰 (mvno)
           ├─> 통신사폰 (mno)
           └─> 인터넷 (internet)
       └─> "권한 저장" 버튼 클릭
           └─> permissions 배열 업데이트
```

**권한 부여 후:**
- `permissions`: `["mvno"]`, `["mno"]`, `["internet"]` 또는 조합
- `permissions_updated_at`: 권한 수정 시간 기록

---

## 🎯 판매자 사이트 사용 동선

### 일반 회원 기능 (동일)

판매자도 일반 회원과 동일하게:
- ✅ 상품 조회 가능
- ✅ 상품 상세 확인 가능
- ✅ 찜하기 가능
- ✅ 상품 신청 가능 (포인트 사용)
- ✅ 리뷰 작성 가능
- ✅ Q&A 작성 가능
- ✅ 마이페이지 접근 가능
- ✅ 주문 내역 확인 가능
- ✅ 포인트 내역 확인 가능

### 판매자 전용 기능

#### 1. 상품 등록

**접근 경로:**
- 판매자 전용 페이지 (현재 미구현, 컴포넌트만 존재)
- 또는 마이페이지에 "상품 등록" 메뉴 추가 필요

**상품 등록 프로세스:**

```
1. 상품 등록 페이지 접속
   └─> 게시판 타입 선택 (mvno/mno/internet)
       └─> 권한 체크
           ├─> 판매자 여부 확인
           ├─> 승인 여부 확인
           └─> 해당 게시판 권한 확인
               └─> 권한 없으면: "권한이 없습니다" 메시지
               └─> 권한 있으면: 상품 등록 폼 표시

2. 상품 정보 입력
   └─> 알뜰폰/통신사폰:
       ├─> 통신사 선택 (KT/SKT/LG U+)
       ├─> 요금제명 입력
       └─> 월 요금 입력
   └─> 인터넷:
       ├─> 인터넷 업체 선택
       ├─> 속도 입력
       └─> 월 요금 입력

3. 상품 등록 제출
   └─> API 호출 (/MVNO/api/product-register.php)
       ├─> 로그인 체크
       ├─> 판매자 여부 체크
       ├─> 승인 여부 체크
       ├─> 권한 체크
       └─> 상품 데이터 저장
           └─> seller_id 저장
           └─> board_type 저장
           └─> created_at 저장
```

**권한 체크 함수:**
```php
// 판매자 권한 확인
hasSellerPermission($userId, $permission); // 'mvno', 'mno', 'internet'

// 현재 판매자 권한 확인
canSellerPost($permission);
```

---

## 📍 판매자 주요 페이지 동선

### 시나리오 1: 승인 대기 중인 판매자

```
1. 로그인
   └─> 일반 회원과 동일한 기능만 사용 가능
       └─> 상품 등록 불가
           └─> "판매자 승인이 필요합니다" 메시지

2. 마이페이지
   └─> 일반 회원과 동일
       └─> 상품 등록 메뉴 없음 (또는 비활성화)
```

### 시나리오 2: 승인되었으나 권한이 없는 판매자

```
1. 로그인
   └─> 상품 등록 페이지 접속 시도
       └─> 권한 체크
           └─> "해당 게시판에 등록할 권한이 없습니다" 메시지
               └─> "관리자에게 권한을 요청하세요"
```

### 시나리오 3: 승인 및 권한이 있는 판매자

```
1. 로그인
   └─> 마이페이지 또는 상품 등록 페이지 접속

2. 상품 등록
   └─> 게시판 타입 선택
       └─> 권한이 있는 게시판만 선택 가능
           ├─> 알뜰폰 (권한 있음)
           ├─> 통신사폰 (권한 있음)
           └─> 인터넷 (권한 있음)
       └─> 상품 정보 입력
       └─> 등록 제출
           └─> 등록 완료

3. 등록한 상품 확인
   └─> (현재 미구현)
       └─> 판매자 대시보드 필요
           ├─> 등록한 상품 목록
           ├─> 상품 수정
           ├─> 상품 삭제
           └─> 상품 통계
```

---

## 🔐 권한 체크 프로세스

### 상품 등록 시 권한 체크 순서

```
1. 로그인 체크
   └─> isLoggedIn()
       └─> false: "로그인이 필요합니다"

2. 판매자 여부 체크
   └─> isSeller()
       └─> false: "판매자만 상품을 등록할 수 있습니다"

3. 승인 여부 체크
   └─> isSellerApproved()
       └─> false: "판매자 승인이 필요합니다"

4. 게시판 권한 체크
   └─> hasSellerPermission($userId, $boardType)
       └─> false: "해당 게시판에 등록할 권한이 없습니다"
       └─> true: 상품 등록 진행
```

### 권한 체크 코드 예시

```php
// 상품 등록 폼에서
$currentUser = getCurrentUser();

// 1. 판매자 여부
if (!$currentUser || $currentUser['role'] !== 'seller') {
    die('판매자만 접근할 수 있습니다.');
}

// 2. 승인 여부
if (!isSellerApproved()) {
    die('판매자 승인이 필요합니다. 관리자에게 문의하세요.');
}

// 3. 게시판 타입 확인
$boardType = $_GET['type'] ?? ''; // mvno, mno, internet

// 4. 권한 체크
if (!hasSellerPermission($currentUser['user_id'], $boardType)) {
    die('해당 게시판에 등록할 권한이 없습니다. 관리자에게 권한을 요청하세요.');
}

// 권한이 있으면 상품 등록 폼 표시
```

---

## 📊 판매자 상태별 접근 가능 기능

### 상태 1: 가입만 완료 (미승인)
| 기능 | 접근 가능 여부 |
|------|---------------|
| 일반 회원 기능 | ✅ 가능 |
| 상품 등록 | ❌ 불가 ("승인 필요" 메시지) |
| 마이페이지 | ✅ 가능 (일반 회원과 동일) |

### 상태 2: 승인 완료 (권한 없음)
| 기능 | 접근 가능 여부 |
|------|---------------|
| 일반 회원 기능 | ✅ 가능 |
| 상품 등록 | ❌ 불가 ("권한 없음" 메시지) |
| 마이페이지 | ✅ 가능 |

### 상태 3: 승인 + 권한 부여 완료
| 기능 | 접근 가능 여부 |
|------|---------------|
| 일반 회원 기능 | ✅ 가능 |
| 상품 등록 | ✅ 가능 (권한이 있는 게시판만) |
| 마이페이지 | ✅ 가능 |
| 등록한 상품 관리 | ⚪ 미구현 |

---

## 🗺️ 판매자 페이지 구조 (현재 및 제안)

### 현재 구현된 것

#### ✅ 관리자 페이지
- `/MVNO/admin/seller-approval.php` - 판매자 승인 관리
- `/MVNO/admin/seller-permissions.php` - 판매자 권한 관리

#### ✅ API
- `/MVNO/api/product-register.php` - 상품 등록 API (권한 체크 포함)

#### ✅ 컴포넌트
- `includes/components/seller-product-form.php` - 상품 등록 폼 예제

### 미구현 (필요한 기능)

#### ❌ 판매자 전용 페이지
- 판매자 대시보드 (상품 등록, 등록한 상품 목록)
- 상품 등록 페이지
- 등록한 상품 관리 페이지
- 판매 통계 페이지

#### ❌ 마이페이지 확장
- 판매자 메뉴 추가
  - 상품 등록
  - 등록한 상품 목록
  - 판매 통계

---

## 💡 판매자 동선 제안

### 제안 1: 마이페이지 확장

```
마이페이지 (/MVNO/mypage/mypage.php)
├─> 일반 회원 메뉴 (기존)
│   ├─> 포인트 정보
│   ├─> 찜한 상품
│   ├─> 주문 내역
│   └─> 기타
│
└─> 판매자 메뉴 (판매자일 경우 표시)
    ├─> 상품 등록
    │   ├─> 알뜰폰 등록 (권한 있으면)
    │   ├─> 통신사폰 등록 (권한 있으면)
    │   └─> 인터넷 등록 (권한 있면)
    │
    ├─> 등록한 상품
    │   ├─> 알뜰폰 목록
    │   ├─> 통신사폰 목록
    │   └─> 인터넷 목록
    │
    └─> 판매 통계
        ├─> 조회수
        ├─> 신청 건수
        └─> 수익 (선택)
```

### 제안 2: 판매자 전용 대시보드

```
판매자 대시보드 (/MVNO/seller/dashboard.php)
├─> 대시보드
│   ├─> 등록한 상품 수
│   ├─> 오늘의 조회수
│   ├─> 오늘의 신청 건수
│   └─> 권한 정보
│
├─> 상품 등록
│   └─> 게시판별 등록 폼
│
├─> 등록한 상품 관리
│   ├─> 상품 목록
│   ├─> 상품 수정
│   └─> 상품 삭제
│
└─> 통계
    └─> 상품별 통계
```

---

## 🔄 판매자 상품 등록 상세 동선

### 1. 상품 등록 페이지 접속

```
경로: /MVNO/seller/product-register.php?type=mvno
또는: /MVNO/mypage/seller/product-register.php?type=mvno

1. 페이지 로드
2. 권한 체크
   ├─> 로그인 확인
   ├─> 판매자 확인
   ├─> 승인 확인
   └─> 게시판 권한 확인
3. 상품 등록 폼 표시
```

### 2. 상품 정보 입력

#### 알뜰폰/통신사폰
```
- 통신사: [KT ▼] [SKT] [LG U+]
- 요금제명: [________________]
- 월 요금: [________] 원
- 데이터량: [________] GB
- 통화: [무제한 ▼]
- 문자: [무제한 ▼]
- 사은품: [________________]
- 이미지: [업로드]
```

#### 인터넷
```
- 인터넷 업체: [KT ▼] [SKT] [LG U+]
- 속도: [500MB ▼]
- 월 요금: [________] 원
- TV 채널: [194개]
- 혜택: [________________]
- 이미지: [업로드]
```

### 3. 상품 등록 제출

```
1. 폼 제출
   └─> POST /MVNO/api/product-register.php
       ├─> board_type: mvno/mno/internet
       ├─> provider: kt/skt/lg
       ├─> plan_name: 요금제명
       ├─> monthly_fee: 월 요금
       └─> 기타 필드

2. API 처리
   ├─> 권한 재확인 (보안)
   ├─> 데이터 검증
   ├─> 상품 데이터 저장
   │   └─> seller_id 저장
   │   └─> board_type 저장
   │   └─> created_at 저장
   └─> 응답 반환

3. 등록 완료
   └─> 성공 메시지
       └─> 등록한 상품 목록으로 이동
```

---

## 📈 판매자 통계 (향후 구현)

### 관리자 페이지에서 확인 가능
- `/MVNO/admin/analytics/seller-stats.php` - 판매자별 통계

### 판매자가 확인할 수 있는 통계 (제안)
- 등록한 상품 수
- 상품별 조회수
- 상품별 신청 건수
- 일별/월별 통계
- 수익 통계 (선택)

---

## ⚠️ 현재 구조의 특징

### 장점
- 명확한 권한 체크 시스템
- 게시판별 세분화된 권한 관리
- 관리자가 쉽게 승인/권한 부여 가능

### 개선 필요 사항
- 판매자 전용 페이지/대시보드 미구현
- 등록한 상품 관리 기능 없음
- 상품 등록 UI/UX 개선 필요
- 판매자 통계 페이지 필요

---

## 🔗 관련 파일

- `includes/data/auth-functions.php` - 권한 관리 함수
  - `isSeller()` - 판매자 여부 확인
  - `isSellerApproved()` - 승인 여부 확인
  - `hasSellerPermission()` - 권한 확인
  - `canSellerPost()` - 현재 판매자 권한 확인
- `admin/seller-approval.php` - 판매자 승인 페이지
- `admin/seller-permissions.php` - 판매자 권한 설정 페이지
- `api/product-register.php` - 상품 등록 API
- `includes/components/seller-product-form.php` - 상품 등록 폼 컴포넌트
- `README_SELLER_PERMISSIONS.md` - 판매자 권한 시스템 문서

---

## 📝 판매자 동선 요약

### 일반적인 사용 흐름

```
1. 관리자에게 판매자 가입 요청
   └─> 관리자가 직접 가입 처리

2. 관리자 승인 대기
   └─> seller_approved: false

3. 관리자 승인
   └─> seller_approved: true
   └─> 하지만 권한은 아직 없음

4. 관리자 권한 부여
   └─> permissions: ["mvno", "mno"] 등

5. 상품 등록 시작
   └─> 상품 등록 페이지 접속
   └─> 권한이 있는 게시판 선택
   └─> 상품 정보 입력
   └─> 등록 제출

6. 등록한 상품 관리 (미구현)
   └─> 상품 목록 확인
   └─> 상품 수정/삭제
   └─> 통계 확인
```

### 권한별 접근 가능 기능

| 권한 | 알뜰폰 등록 | 통신사폰 등록 | 인터넷 등록 |
|------|------------|--------------|------------|
| `["mvno"]` | ✅ | ❌ | ❌ |
| `["mno"]` | ❌ | ✅ | ❌ |
| `["internet"]` | ❌ | ❌ | ✅ |
| `["mvno", "mno"]` | ✅ | ✅ | ❌ |
| `["mvno", "mno", "internet"]` | ✅ | ✅ | ✅ |

---

## 🎯 향후 구현 제안

### Phase 1: 기본 기능
1. 판매자 전용 상품 등록 페이지
2. 등록한 상품 목록 페이지
3. 마이페이지에 판매자 메뉴 추가

### Phase 2: 관리 기능
4. 등록한 상품 수정
5. 등록한 상품 삭제
6. 상품 상태 관리 (활성/비활성)

### Phase 3: 통계 및 분석
7. 판매자 대시보드
8. 상품별 통계
9. 일별/월별 통계











