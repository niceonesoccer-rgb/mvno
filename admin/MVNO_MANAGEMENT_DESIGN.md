# 알뜰폰 관리 페이지 설계 문서

## 1. 개요

관리자 페이지에서 알뜰폰 요금제를 체계적으로 관리하기 위한 페이지 설계입니다.
- 알뜰폰 요금제 목록 조회
- 알뜰폰 요금제 추가/수정/삭제
- 검색, 필터링, 정렬 기능
- 페이지네이션

## 2. 파일 구조

```
admin/
├── products/
│   ├── mvno-list.php          # 알뜰폰 목록 페이지 (메인)
│   ├── mvno-add.php           # 알뜰폰 추가 페이지
│   ├── mvno-edit.php          # 알뜰폰 수정 페이지
│   └── mvno-detail.php        # 알뜰폰 상세보기 페이지 (선택사항)
├── api/
│   ├── mvno-create.php        # 알뜰폰 생성 API
│   ├── mvno-update.php        # 알뜰폰 수정 API
│   ├── mvno-delete.php        # 알뜰폰 삭제 API
│   └── mvno-list.php          # 알뜰폰 목록 조회 API (AJAX용)
└── includes/
    └── data/
        └── mvno-functions.php  # 알뜰폰 데이터 처리 함수
```

## 3. 데이터 구조

### 3.1 알뜰폰 요금제 데이터 구조

```php
[
    // 기본 식별 정보
    'id' => 32627,                          // 고유 ID (숫자)
    'provider' => '쉐이크모바일',            // 통신사명
    'rating' => '4.3',                      // 평점 (문자열, 0.0 ~ 5.0)
    'title' => '11월한정 LTE 100GB+밀리+Data쿠폰60GB',  // 요금제명
    'data_main' => '월 100GB + 5Mbps',      // 데이터 용량 (표시용)
    'selection_count' => '29,448명이 선택', // 선택 수 (표시용)
    
    // 기본 정보
    'contract' => '없음',                    // 통신사 약정: '없음', '12개월', '24개월' 등
    'network' => 'KT알뜰폰 망',              // 통신망: 'KT알뜰폰 망', 'SKT알뜰폰 망', 'LG U+알뜰폰 망' (알뜰폰이 사용하는 통신망)
    'technology' => 'LTE',                   // 통신 기술: 'LTE', '5G', 'LTE+5G'
    
    // 데이터 정보
    'voice' => '무제한',                    // 통화: '무제한', '100분', '200분' 등
    'sms' => '무제한',                      // 문자: '무제한', '100건', '200건' 등
    'data_amount' => '월 100GB',            // 데이터 제공량: '월 100GB', '월 11GB' 등
    'data_exhausted' => '5mbps 속도로 무제한', // 데이터 소진시: '5mbps 속도로 무제한', '추가 요금' 등
    'additional_voice' => '300분',          // 부가통화: '300분', '무제한', '없음' 등
    'hotspot' => '데이터 제공량 내',         // 모바일 핫스팟: '데이터 제공량 내', '제한', '없음' 등
    'data_sharing' => '데이터 제공량 내',    // 데이터 쉐어링: '데이터 제공량 내', '제한', '없음' 등
    
    // 유심 정보
    'usim' => [                             // 유심 정보
        'regular' => [                       // 일반 유심
            'available' => true,             // 배송가능 여부
            'price' => 6600,                 // 가격 (원)
            'note' => '배송가능'             // 비고
        ],
        'nfc' => [                           // NFC 유심
            'available' => false,
            'price' => 0,
            'note' => '배송불가'
        ],
        'esim' => [                          // eSIM
            'available' => true,
            'price' => 2750,
            'note' => '개통가능'
        ]
    ],
    
    // 초과 요금 정보
    'overage' => [
        'data' => '22.53원/MB',             // 데이터 초과 요금
        'voice' => '1.98원/초',             // 음성 통화 초과 요금
        'video_call' => '3.3원/초',         // 부가/영상통화 초과 요금
        'sms' => '22원/개',                 // 단문메시지(SMS) 초과 요금
        'mms' => '44원/개'                  // 장문 텍스트형(MMS) 초과 요금
    ],
    
    // 특징 (기존 features와 호환)
    'features' => [                         // 특징 배열 (프론트엔드 표시용)
        '통화 무제한',
        '문자 무제한',
        'KT알뜰폰 망',
        'LTE'
    ],
    
    // 가격 정보
    'price_main' => '월 17,000원',          // 메인 가격
    'price_after' => '7개월 이후 42,900원', // 이후 가격
    'price_main_numeric' => 17000,          // 메인 가격 (숫자, 정렬용)
    'price_after_numeric' => 42900,         // 이후 가격 (숫자, 정렬용)
    
    // 혜택 정보
    'gifts' => [                            // 혜택 배열
        'SOLO결합(+20GB)',
        '밀리의서재 평생 무료 구독권',
        '데이터쿠폰 20GB',
        '[11월 한정]네이버페이 10,000원',
        '3대 마트 상품권 2만원'
    ],
    'gift_icons' => [                      // 혜택 아이콘 배열
        [
            'src' => 'https://assets.moyoplan.com/image/mvno-gifts/badge/emart.svg',
            'alt' => '이마트 상품권'
        ],
        // ...
    ],
    'gift_count' => 5,                      // 사은품 개수 (표시용)
    
    // 혜택 및 유의사항
    'benefits_note' => '여기 추가내용',     // 혜택 및 유의사항 (텍스트 에디터)
    
    // 관리 정보
    'status' => 'active',                   // 상태: 'active', 'inactive', 'deleted'
    'created_at' => '2024-01-01 00:00:00', // 생성일시
    'updated_at' => '2024-01-01 00:00:00', // 수정일시
    'created_by' => 'admin_user_id',       // 생성자 ID
    'updated_by' => 'admin_user_id'        // 수정자 ID
]
```

### 3.2 데이터 저장 방식

**현재**: `includes/data/plan-data.php`에 하드코딩된 배열
**향후**: JSON 파일 또는 데이터베이스로 전환 예정

**JSON 파일 구조 (권장)**:
```
data/
└── mvno-plans.json
```

```json
{
    "plans": [
        {
            "id": 32627,
            "provider": "쉐이크모바일",
            ...
        }
    ],
    "last_id": 32635,
    "updated_at": "2024-01-01 00:00:00"
}
```

## 4. 기능 목록

### 4.1 목록 페이지 (mvno-list.php)

#### 4.1.1 주요 기능
- [ ] 알뜰폰 요금제 목록 표시 (테이블 또는 카드 형태)
- [ ] 검색 기능 (제목, 통신사명, 요금제명으로 검색)
- [ ] 필터링 기능
  - [ ] 통신망별 필터 (KT알뜰폰 망, SKT알뜰폰 망, LG U+알뜰폰 망)
  - [ ] 가격대별 필터
  - [ ] 데이터 용량별 필터
  - [ ] 상태별 필터 (활성/비활성)
- [ ] 정렬 기능
  - [ ] 최신순 (기본)
  - [ ] 가격 낮은순/높은순
  - [ ] 선택 수 많은순
  - [ ] 평점 높은순
- [ ] 페이지네이션 (10개, 50개, 100개 단위 선택)
- [ ] 일괄 작업
  - [ ] 선택 삭제
  - [ ] 선택 비활성화/활성화
- [ ] 통계 표시
  - [ ] 전체 요금제 수
  - [ ] 활성 요금제 수
  - [ ] 비활성 요금제 수

#### 4.1.2 UI 구성
```
┌─────────────────────────────────────────────────────────┐
│ 알뜰폰 관리                                    [+ 추가] │
├─────────────────────────────────────────────────────────┤
│ 통계 카드: 전체 | 활성 | 비활성                          │
├─────────────────────────────────────────────────────────┤
│ [검색창] [통신사▼] [가격대▼] [정렬▼] [표시개수▼]        │
├─────────────────────────────────────────────────────────┤
│ ☑ ID | 통신사 | 요금제명 | 가격 | 데이터 | 상태 | 관리  │
│ ☑ 1   | 쉐이크 | ...     | ...  | ...   | 활성 | [수정][삭제] │
│ ☐ 2   | 고고   | ...     | ...  | ...   | 활성 | [수정][삭제] │
├─────────────────────────────────────────────────────────┤
│ [선택삭제] [선택비활성화]                                │
│ [< 1 2 3 4 5 >]                                          │
└─────────────────────────────────────────────────────────┘
```

### 4.2 추가 페이지 (mvno-add.php)

#### 4.2.1 주요 기능
- [ ] 폼 입력 필드
  - [ ] **기본 정보**
    - [ ] 통신사명 (드롭다운 또는 입력) *
    - [ ] 요금제명 (제목) *
    - [ ] 평점 (0.0 ~ 5.0, 숫자 입력)
    - [ ] 통신사 약정 (없음/12개월/24개월 등)
    - [ ] 통신망 (KT알뜰폰 망/SKT알뜰폰 망/LG U+알뜰폰 망) * - 알뜰폰이 사용하는 통신망
    - [ ] 통신 기술 (LTE/5G/LTE+5G) *
  - [ ] **데이터 정보**
    - [ ] 통화 (무제한/제한 분수 입력) *
    - [ ] 문자 (무제한/제한 건수 입력) *
    - [ ] 데이터 제공량 (월 XXGB 형식) *
    - [ ] 데이터 소진시 (5mbps 속도로 무제한/추가 요금 등)
    - [ ] 부가통화 (분수 입력 또는 무제한)
    - [ ] 모바일 핫스팟 (데이터 제공량 내/제한/없음)
    - [ ] 데이터 쉐어링 (데이터 제공량 내/제한/없음)
  - [ ] **유심 정보**
    - [ ] 일반 유심 (배송가능 여부, 가격)
    - [ ] NFC 유심 (배송가능 여부, 가격)
    - [ ] eSIM (개통가능 여부, 가격)
  - [ ] **초과 요금 정보**
    - [ ] 데이터 초과 요금 (원/MB)
    - [ ] 음성 통화 초과 요금 (원/초)
    - [ ] 부가/영상통화 초과 요금 (원/초)
    - [ ] 단문메시지(SMS) 초과 요금 (원/개)
    - [ ] 장문 텍스트형(MMS) 초과 요금 (원/개)
  - [ ] **가격 정보**
    - [ ] 메인 가격 (표시용 텍스트) *
    - [ ] 메인 가격 (숫자, 정렬용) *
    - [ ] 이후 가격 (표시용 텍스트)
    - [ ] 이후 가격 (숫자, 정렬용)
  - [ ] **혜택 정보**
    - [ ] 혜택 목록 (동적 추가/삭제)
    - [ ] 혜택 아이콘 (이미지 업로드 또는 URL, Alt 텍스트)
    - [ ] 혜택 및 유의사항 (텍스트 에디터)
  - [ ] **기타**
    - [ ] 선택 수 (기본값: 0, 표시용)
    - [ ] 상태 (활성/비활성) *
- [ ] 유효성 검사
- [ ] 미리보기 기능 (선택사항)
- [ ] 저장 및 취소 버튼

#### 4.2.2 UI 구성
```
┌─────────────────────────────────────────────────────────┐
│ 알뜰폰 추가                                    [목록으로] │
├─────────────────────────────────────────────────────────┤
│ ▼ 기본 정보                                              │
│ 통신사명 *        [드롭다운]                             │
│ 요금제명 *        [입력창]                               │
│ 평점              [0.0 ~ 5.0 숫자 입력]                 │
│ 통신사 약정       [없음▼]                                │
│ 통신망 *          [KT알뜰폰 망▼]                         │
│ 통신 기술 *       [LTE▼]                                │
├─────────────────────────────────────────────────────────┤
│ ▼ 데이터 정보                                            │
│ 통화 *            [무제한▼] 또는 [제한: 분수 입력]        │
│ 문자 *            [무제한▼] 또는 [제한: 건수 입력]        │
│ 데이터 제공량 *   [월 100GB 입력]                        │
│ 데이터 소진시     [5mbps 속도로 무제한▼]                 │
│ 부가통화          [300분 입력] 또는 [무제한▼]            │
│ 모바일 핫스팟     [데이터 제공량 내▼]                    │
│ 데이터 쉐어링     [데이터 제공량 내▼]                    │
├─────────────────────────────────────────────────────────┤
│ ▼ 유심 정보                                              │
│ 일반 유심         ☑ 배송가능 [가격: 6600원]              │
│ NFC 유심          ☐ 배송불가 [가격: 0원]                 │
│ eSIM              ☑ 개통가능 [가격: 2750원]              │
├─────────────────────────────────────────────────────────┤
│ ▼ 초과 요금 정보                                         │
│ 데이터            [22.53원/MB 입력]                     │
│ 음성 통화         [1.98원/초 입력]                      │
│ 부가/영상통화      [3.3원/초 입력]                       │
│ 단문메시지(SMS)   [22원/개 입력]                        │
│ 장문 텍스트형(MMS) [44원/개 입력]                       │
├─────────────────────────────────────────────────────────┤
│ ▼ 가격 정보                                              │
│ 메인 가격(표시) * [월 17,000원 입력]                     │
│ 메인 가격(숫자) * [17000 입력]                          │
│ 이후 가격(표시)   [7개월 이후 42,900원 입력]              │
│ 이후 가격(숫자)   [42900 입력]                           │
├─────────────────────────────────────────────────────────┤
│ ▼ 혜택 정보                                              │
│ 혜택 목록         [+ 추가]                               │
│   - 혜택 1        [입력] [삭제]                         │
│   - 혜택 2        [입력] [삭제]                         │
│ 혜택 아이콘        [+ 추가]                               │
│   - 아이콘 1      [이미지 업로드/URL] [Alt 텍스트] [삭제]│
│ 혜택 및 유의사항   [텍스트 에디터]                        │
├─────────────────────────────────────────────────────────┤
│ ▼ 기타 정보                                              │
│ 선택 수           [29448 입력] (기본: 0)                  │
│ 상태 *            ○ 활성  ○ 비활성                      │
├─────────────────────────────────────────────────────────┤
│ [취소] [저장]                                            │
└─────────────────────────────────────────────────────────┘
```

### 4.3 수정 페이지 (mvno-edit.php)

#### 4.3.1 주요 기능
- [ ] 기존 데이터 불러오기
- [ ] 추가 페이지와 동일한 폼 구조
- [ ] 수정 이력 표시 (선택사항)
- [ ] 삭제 버튼 (확인 모달 포함)

### 4.4 상세보기 페이지 (mvno-detail.php) - 선택사항

#### 4.4.1 주요 기능
- [ ] 요금제 상세 정보 표시
- [ ] 수정/삭제 버튼
- [ ] 통계 정보 (조회수, 선택수 등)

## 5. API 엔드포인트 설계

### 5.1 알뜰폰 생성 (POST /api/mvno-create.php)

**Request:**
```json
{
    "action": "create",
    "provider": "쉐이크모바일",
    "title": "11월한정 LTE 100GB+밀리+Data쿠폰60GB",
    "rating": "4.3",
    "contract": "없음",
    "network": "KT알뜰폰 망",
    "technology": "LTE",
    "voice": "무제한",
    "sms": "무제한",
    "data_amount": "월 100GB",
    "data_exhausted": "5mbps 속도로 무제한",
    "additional_voice": "300분",
    "hotspot": "데이터 제공량 내",
    "data_sharing": "데이터 제공량 내",
    "usim": {
        "regular": {"available": true, "price": 6600, "note": "배송가능"},
        "nfc": {"available": false, "price": 0, "note": "배송불가"},
        "esim": {"available": true, "price": 2750, "note": "개통가능"}
    },
    "overage": {
        "data": "22.53원/MB",
        "voice": "1.98원/초",
        "video_call": "3.3원/초",
        "sms": "22원/개",
        "mms": "44원/개"
    },
    "price_main": "월 17,000원",
    "price_main_numeric": 17000,
    "price_after": "7개월 이후 42,900원",
    "price_after_numeric": 42900,
    "selection_count": "0명이 선택",
    "gifts": ["혜택1", "혜택2"],
    "gift_icons": [
        {"src": "url", "alt": "alt text"}
    ],
    "benefits_note": "여기 추가내용",
    "status": "active"
}
```

**Response:**
```json
{
    "success": true,
    "message": "알뜰폰 요금제가 추가되었습니다.",
    "plan_id": 32636
}
```

### 5.2 알뜰폰 수정 (POST /api/mvno-update.php)

**Request:**
```json
{
    "action": "update",
    "plan_id": 32627,
    "provider": "쉐이크모바일",
    ...
}
```

**Response:**
```json
{
    "success": true,
    "message": "알뜰폰 요금제가 수정되었습니다."
}
```

### 5.3 알뜰폰 삭제 (POST /api/mvno-delete.php)

**Request:**
```json
{
    "action": "delete",
    "plan_ids": [32627, 32628]  // 단일 또는 다중 삭제
}
```

**Response:**
```json
{
    "success": true,
    "message": "2개의 요금제가 삭제되었습니다.",
    "deleted_count": 2
}
```

### 5.4 알뜰폰 목록 조회 (GET /api/mvno-list.php)

**Query Parameters:**
- `page`: 페이지 번호 (기본: 1)
- `per_page`: 페이지당 개수 (기본: 10)
- `search`: 검색어
- `provider`: 통신사 필터
- `network`: 통신망 필터 (KT알뜰폰 망, SKT알뜰폰 망, LG U+알뜰폰 망)
- `status`: 상태 필터 (active/inactive)
- `sort`: 정렬 기준 (created_at, price, selection_count, rating)
- `order`: 정렬 방향 (asc/desc)

**Response:**
```json
{
    "success": true,
    "data": {
        "plans": [...],
        "pagination": {
            "current_page": 1,
            "per_page": 10,
            "total": 100,
            "total_pages": 10
        }
    }
}
```

## 6. 데이터 처리 함수 설계 (mvno-functions.php)

### 6.1 필수 함수 목록

```php
/**
 * 알뜰폰 요금제 목록 가져오기
 * @param array $filters 필터 조건
 * @param int $page 페이지 번호
 * @param int $perPage 페이지당 개수
 * @param string $sort 정렬 기준
 * @param string $order 정렬 방향
 * @return array
 */
function getMvnoPlans($filters = [], $page = 1, $perPage = 10, $sort = 'created_at', $order = 'desc')

/**
 * 알뜰폰 요금제 상세 정보 가져오기
 * @param int $planId 요금제 ID
 * @return array|null
 */
function getMvnoPlanById($planId)

/**
 * 알뜰폰 요금제 생성
 * @param array $data 요금제 데이터
 * @return array ['success' => bool, 'plan_id' => int, 'message' => string]
 */
function createMvnoPlan($data)

/**
 * 알뜰폰 요금제 수정
 * @param int $planId 요금제 ID
 * @param array $data 수정할 데이터
 * @return array ['success' => bool, 'message' => string]
 */
function updateMvnoPlan($planId, $data)

/**
 * 알뜰폰 요금제 삭제
 * @param array $planIds 삭제할 요금제 ID 배열
 * @return array ['success' => bool, 'deleted_count' => int, 'message' => string]
 */
function deleteMvnoPlans($planIds)

/**
 * 알뜰폰 요금제 검색
 * @param string $query 검색어
 * @param array $filters 추가 필터
 * @return array
 */
function searchMvnoPlans($query, $filters = [])

/**
 * 알뜰폰 통계 가져오기
 * @return array ['total' => int, 'active' => int, 'inactive' => int]
 */
function getMvnoStats()

/**
 * 다음 요금제 ID 생성
 * @return int
 */
function getNextMvnoPlanId()
```

## 7. UI/UX 설계

### 7.1 디자인 원칙
- 기존 관리자 페이지 디자인과 일관성 유지
- 반응형 디자인 (모바일 대응)
- 직관적인 인터페이스
- 빠른 작업을 위한 단축키 지원 (선택사항)

### 7.2 색상 및 스타일
- 기존 admin-header.php의 스타일 활용
- 통신사별 색상 구분 (KT: 빨강, SKT: 초록, LG U+: 보라)
- 상태별 색상 (활성: 초록, 비활성: 회색)

### 7.3 사용자 경험
- 삭제 시 확인 모달 표시
- 저장 성공/실패 알림 (Toast 메시지)
- 로딩 상태 표시
- 폼 유효성 검사 실시간 피드백

## 8. 보안 고려사항

- [ ] 관리자 권한 확인 (모든 API 엔드포인트)
- [ ] CSRF 토큰 검증
- [ ] 입력 데이터 검증 및 Sanitization
- [ ] XSS 방지 (출력 시 htmlspecialchars 사용)
- [ ] 파일 업로드 시 보안 검증 (혜택 아이콘)

## 9. 향후 확장 계획

- [ ] 대량 업로드 (CSV/Excel)
- [ ] 요금제 복사 기능
- [ ] 버전 관리 (수정 이력)
- [ ] 이미지 관리 (혜택 아이콘)
- [ ] 통계 대시보드 연동
- [ ] API 연동 (외부 데이터 소스)

## 10. 구현 우선순위

### Phase 1 (필수)
1. 목록 페이지 (mvno-list.php)
2. 데이터 조회 함수 (getMvnoPlans)
3. 추가 페이지 (mvno-add.php)
4. 생성 API (mvno-create.php)
5. 수정 페이지 (mvno-edit.php)
6. 수정 API (mvno-update.php)
7. 삭제 API (mvno-delete.php)

### Phase 2 (중요)
1. 검색 기능
2. 필터링 기능
3. 정렬 기능
4. 페이지네이션
5. 통계 표시

### Phase 3 (선택)
1. 일괄 작업
2. 상세보기 페이지
3. 미리보기 기능
4. 이미지 관리

## 11. 필수 입력 필드 정리

### 11.1 기본 정보 (필수)
- 통신사명 (provider) * - 예: 쉐이크모바일, 고고모바일 등
- 요금제명 (title) *
- 통신망 (network) * - KT알뜰폰 망, SKT알뜰폰 망, LG U+알뜰폰 망 (알뜰폰이 사용하는 통신망)
- 통신 기술 (technology) * - LTE, 5G, LTE+5G

### 11.2 데이터 정보 (필수)
- 통화 (voice) * - 무제한 또는 분수
- 문자 (sms) * - 무제한 또는 건수
- 데이터 제공량 (data_amount) * - 예: "월 100GB"

### 11.3 가격 정보 (필수)
- 메인 가격 표시용 (price_main) * - 예: "월 17,000원"
- 메인 가격 숫자 (price_main_numeric) * - 정렬용

### 11.4 선택 입력 필드
- 평점 (rating) - 0.0 ~ 5.0
- 통신사 약정 (contract) - 없음, 12개월, 24개월 등
- 데이터 소진시 (data_exhausted) - "5mbps 속도로 무제한" 등
- 부가통화 (additional_voice) - 분수 또는 무제한
- 모바일 핫스팟 (hotspot) - 데이터 제공량 내, 제한, 없음
- 데이터 쉐어링 (data_sharing) - 데이터 제공량 내, 제한, 없음
- 이후 가격 (price_after, price_after_numeric)
- 선택 수 (selection_count) - 기본값: 0

### 11.5 유심 정보 (선택)
- 일반 유심 (usim.regular) - 배송가능 여부, 가격
- NFC 유심 (usim.nfc) - 배송가능 여부, 가격
- eSIM (usim.esim) - 개통가능 여부, 가격

### 11.6 초과 요금 정보 (선택)
- 데이터 초과 요금 (overage.data) - 예: "22.53원/MB"
- 음성 통화 초과 요금 (overage.voice) - 예: "1.98원/초"
- 부가/영상통화 초과 요금 (overage.video_call) - 예: "3.3원/초"
- 단문메시지 초과 요금 (overage.sms) - 예: "22원/개"
- 장문 텍스트형 초과 요금 (overage.mms) - 예: "44원/개"

### 11.7 혜택 정보 (선택)
- 혜택 목록 (gifts) - 배열
- 혜택 아이콘 (gift_icons) - 이미지 URL과 Alt 텍스트
- 혜택 및 유의사항 (benefits_note) - 텍스트 에디터

### 11.8 관리 정보
- 상태 (status) * - active, inactive

## 12. 참고사항

- 현재 `plan-data.php`는 하드코딩된 배열 사용
- 향후 JSON 파일 또는 데이터베이스로 전환 필요
- 기존 `getPlansData()` 함수와의 호환성 고려
- 프론트엔드 페이지(`mvno.php`)와의 연동 확인 필요
- 프론트엔드 상세 페이지에 표시되는 모든 정보를 관리자 페이지에서 관리 가능해야 함


