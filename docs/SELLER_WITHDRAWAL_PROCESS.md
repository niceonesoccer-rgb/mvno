# 판매자 탈퇴 프로세스 설명

## 📋 현재 시스템의 탈퇴 프로세스

### 1단계: 판매자가 탈퇴 요청
- **위치**: 판매자 프로필 페이지 (`/seller/profile.php`)
- **동작**:
  - 판매자가 탈퇴 사유를 입력하고 탈퇴 요청
  - `requestSellerWithdrawal()` 함수 실행
  - 계정 상태: `withdrawal_requested = 1`, `approval_status = 'withdrawal_requested'`
  - **모든 상품 자동 판매종료**: `status = 'inactive'`
  - 계정 비활성화 (로그인 불가)
  - 세션 자동 로그아웃

### 2단계: 관리자가 탈퇴 요청 확인
- **위치**: 관리자 페이지 (`/admin/seller-approval.php?tab=withdrawal`)
- **현재 가능한 작업**:
  1. ✅ **탈퇴 완료 처리** (`complete_withdrawal`)
     - 개인정보 비식별화/삭제
     - `scheduled_delete_date` 설정 가능 (5년 후 자동 삭제 예약)
  2. ✅ **탈퇴 요청 취소** (`cancel_withdrawal`)
     - 탈퇴 요청을 취소하고 계정 복구
  3. ❌ **탈퇴 요청 반려** - **현재 없음**

### 3단계: 탈퇴 완료 처리 시
- **개인정보 처리**:
  - 즉시 삭제: 이메일, 전화번호, 주소, 사업자 정보 등
  - 보존: 상품 정보, 주문 내역, 리뷰 등 (법적 보존 의무)
- **스케줄 삭제**:
  - `scheduled_delete_date` 설정 시 해당 날짜에 자동 삭제 예약
  - **현재 자동 실행 로직 없음** (수동 실행 필요)

---

## ⚠️ 현재 시스템의 문제점

### 1. 탈퇴 요청 반려 기능 없음
- 판매자가 탈퇴 요청을 했을 때, 관리자가 "반려"할 수 있는 기능이 없습니다.
- 현재는 "탈퇴 요청 취소"만 가능하며, 이는 관리자가 직접 취소하는 것입니다.

### 2. 5년 후 자동 삭제 스케줄링 미완성
- `scheduled_delete_date` 필드는 있지만, 자동으로 실행되는 스크립트가 없습니다.
- 현재는 수동으로 스케줄 삭제를 실행해야 합니다.

---

## 🔧 개선 방안

### 방안 1: 탈퇴 요청 반려 기능 추가

**필요한 기능**:
1. 관리자가 탈퇴 요청을 "반려"할 수 있는 버튼 추가
2. 반려 시:
   - `withdrawal_requested = 0` (탈퇴 요청 취소)
   - `approval_status = 'approved'` (승인 상태로 복구)
   - 상품 상태 복구: `status = 'active'` (판매 재개)
   - 계정 활성화 (로그인 가능)
   - 반려 사유 저장

**구현 위치**:
- `admin/seller-approval.php`: UI 버튼 추가
- `includes/data/auth-functions.php`: `rejectSellerWithdrawal()` 함수 추가

### 방안 2: 5년 후 자동 삭제 스케줄링 구현

**필요한 기능**:
1. 탈퇴 완료 처리 시 자동으로 `scheduled_delete_date = 탈퇴일 + 5년` 설정
2. 매일 실행되는 스크립트로 `scheduled_delete_date`가 지난 계정 자동 삭제
3. 삭제 전 알림 기능 (선택사항)

**구현 방법**:
- **옵션 A**: Cron Job으로 매일 실행되는 PHP 스크립트
- **옵션 B**: 페이지 접근 시 자동 실행 (성능 고려 필요)
- **옵션 C**: 관리자 페이지에서 수동 실행 버튼

**권장**: 옵션 A (Cron Job) + 옵션 C (수동 실행 버튼)

---

## 📝 일반적인 판매자 탈퇴 프로세스 (권장)

### 표준 프로세스

```
1. 판매자 탈퇴 요청
   ↓
2. 관리자 검토
   ├─ 승인 → 3단계로 진행
   ├─ 반려 → 계정 복구, 상품 재활성화
   └─ 보류 → 추가 검토 필요
   ↓
3. 탈퇴 완료 처리
   ├─ 즉시: 개인정보 삭제/비식별화
   ├─ 즉시: 상품 판매종료
   └─ 예약: 5년 후 완전 삭제 (scheduled_delete_date)
   ↓
4. 5년 후 자동 삭제 (스케줄 실행)
   └─ 남은 개인정보 완전 삭제
```

### 데이터 보존 정책

**보존 (법적 의무)**:
- 상품 정보 (상품명, 가격, 설명 등)
- 주문 내역 (신청내역, 거래 기록)
- 리뷰 및 평가 정보
- 통계 데이터

**삭제/비식별화**:
- 개인정보 (이름, 이메일, 전화번호, 주소)
- 사업자 정보 (사업자등록번호, 사업자명 등)
- 로그인 정보 (비밀번호 해시는 보존, 로그인 불가)

---

## 🛠️ 구현 우선순위

1. **높음**: 탈퇴 요청 반려 기능
   - 관리자가 탈퇴 요청을 검토하고 반려할 수 있어야 함
   - 반려 시 계정과 상품 자동 복구

2. **중간**: 5년 후 자동 삭제 스케줄링
   - 탈퇴 완료 시 자동으로 5년 후 삭제 예약
   - 자동 실행 스크립트 구현

3. **낮음**: 삭제 전 알림 기능
   - 5년이 지나기 전에 알림 (선택사항)

---

## 💡 참고사항

- **개인정보보호법**: 개인정보는 최대 5년 보관 후 삭제
- **전자상거래법**: 거래 기록은 5년간 보존 의무
- **소비자기본법**: 리뷰 등 소비자 정보 보존 필요

따라서 **개인정보는 삭제하되, 거래 관련 데이터는 보존**하는 것이 올바른 접근입니다.
