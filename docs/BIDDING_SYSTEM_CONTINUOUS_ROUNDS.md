# 연속 입찰 라운드 시스템 설계

## 📌 개요

입찰 시스템은 연속적으로 진행되며, 입찰 기간과 게시 기간을 자유롭게 설정할 수 있습니다.
현재 입찰과 다음 입찰을 미리 설정할 수 있으며, 기간이 일정하지 않아도 문제없습니다.
판매자는 현재 진행 중인 입찰과 다음 입찰을 명확히 구분하여 참여할 수 있습니다.

**중요:**
- 입찰 기간과 게시 기간은 자유롭게 설정 가능
- 예: 입찰 3개월, 게시 6개월
- 예: 다음 입찰은 입찰 1주일, 게시 1개월
- 기간이 일정하지 않아도 시스템이 정상 작동

---

## 🔄 시스템 흐름

### 예시 시나리오

#### 예시 1: 월별 입찰 (일정한 기간)

**2025년 12월 입찰 라운드**
```
입찰 기간: 2025-11-15 00:00:00 ~ 2025-11-30 23:59:59 (약 2주)
게시 기간: 2025-12-01 00:00:00 ~ 2025-12-31 23:59:59 (1개월)
상태: displaying (게시 중)
```

**2026년 1월 입찰 라운드 (미리 설정)**
```
입찰 기간: 2025-12-15 00:00:00 ~ 2025-12-31 23:59:59 (약 2주)
게시 기간: 2026-01-01 00:00:00 ~ 2026-01-31 23:59:59 (1개월)
상태: bidding (입찰 진행 중) - 12월 15일부터
```

#### 예시 2: 불규칙한 기간 (3개월 입찰, 6개월 게시)

**2025년 하반기 입찰 라운드**
```
입찰 기간: 2025-07-01 00:00:00 ~ 2025-09-30 23:59:59 (3개월)
게시 기간: 2025-10-01 00:00:00 ~ 2026-03-31 23:59:59 (6개월)
상태: displaying (게시 중)
```

**2026년 상반기 입찰 라운드 (미리 설정)**
```
입찰 기간: 2025-12-01 00:00:00 ~ 2026-01-31 23:59:59 (2개월)
게시 기간: 2026-04-01 00:00:00 ~ 2026-06-30 23:59:59 (3개월)
상태: bidding (입찰 진행 중) - 12월 1일부터
```

**중요:**
- 입찰 기간과 게시 기간은 각 라운드마다 다르게 설정 가능
- 시스템은 설정된 날짜(display_start_at, display_end_at) 기준으로 자동 전환
- 기간이 일정하지 않아도 문제없음

---

## ⏰ 시간 흐름 및 자동 전환

### 자동 전환 원리

시스템은 각 라운드의 `display_start_at`과 `display_end_at` 날짜를 기준으로 자동 전환합니다.
입찰 기간과 게시 기간이 일정하지 않아도 각 라운드의 설정된 날짜에 따라 정확히 작동합니다.

### 예시 1: 월별 입찰 (2025-12-31 → 2026-01-01 전환)

```
[2025-12-31 23:59:59] 이전
├─ 12월 입찰 라운드: status='displaying' (게시 중)
│  └─ display_end_at: 2025-12-31 23:59:59
│  └─ 낙찰자 게시물이 상단에 노출 중
│
└─ 1월 입찰 라운드: status='bidding' (입찰 진행 중)
   └─ display_start_at: 2026-01-01 00:00:00
   └─ 판매자들이 입찰 참여 중

[2026-01-01 00:00:00] 전환 시점
├─ 12월 입찰 라운드: status='finished' (자동 종료)
│  └─ display_end_at < NOW() 조건 충족
│  └─ 게시물이 일반 게시물로 전환
│
└─ 1월 입찰 라운드: status='displaying' (자동 시작)
   └─ display_start_at <= NOW() 조건 충족
   └─ 새 낙찰자 게시물이 상단에 노출
```

### 예시 2: 불규칙한 기간 (2026-03-31 → 2026-04-01 전환)

```
[2026-03-31 23:59:59] 이전
├─ 하반기 입찰 라운드: status='displaying' (게시 중)
│  └─ display_end_at: 2026-03-31 23:59:59
│  └─ 입찰 기간: 3개월, 게시 기간: 6개월
│
└─ 상반기 입찰 라운드: status='bidding' (입찰 진행 중)
   └─ display_start_at: 2026-04-01 00:00:00
   └─ 입찰 기간: 2개월, 게시 기간: 3개월

[2026-04-01 00:00:00] 전환 시점
├─ 하반기 입찰 라운드: status='finished' (자동 종료)
│
└─ 상반기 입찰 라운드: status='displaying' (자동 시작)
```

**중요:**
- 각 라운드의 `display_start_at`과 `display_end_at`만 확인하면 됨
- 입찰 기간이 3개월이든 1주일이든 상관없음
- 게시 기간이 6개월이든 1개월이든 상관없음
- 시스템은 설정된 날짜 기준으로만 작동

---

## 📋 데이터베이스 설계

### bidding_rounds 테이블 (추가 필드 없음, 기존 구조 유지)

기존 필드로 충분하지만, 자동 전환 로직이 필요합니다:
- `status`: 상태 관리
- `display_start_at`: 게시 시작 시간
- `display_end_at`: 게시 종료 시간
- `bidding_end_at`: 입찰 종료 시간

### 자동 전환 로직 (Cron Job 또는 스케줄러)

```sql
-- 매일 자정(00:00:00) 실행되는 배치 작업

-- 1. 게시 기간 종료된 라운드를 finished로 전환
UPDATE bidding_rounds
SET status = 'finished'
WHERE status = 'displaying'
  AND display_end_at < NOW();

-- 2. 게시 시작 시간이 된 라운드를 displaying으로 전환
UPDATE bidding_rounds
SET status = 'displaying'
WHERE status = 'closed'
  AND display_start_at <= NOW();

-- 3. 입찰 종료 시간이 된 라운드를 closed로 전환
UPDATE bidding_rounds
SET status = 'closed'
WHERE status = 'bidding'
  AND bidding_end_at < NOW();
```

---

## 🎯 판매자 입찰 화면 설계

### 현재 입찰과 다음 입찰 구분

#### 입찰 목록 화면

```
┌─────────────────────────────────────────┐
│ 입찰 라운드 목록                        │
├─────────────────────────────────────────┤
│                                         │
│ [진행 중인 입찰]                        │
│ ┌─────────────────────────────────────┐ │
│ │ 알뜰폰 (MVNO)                       │ │
│ │ 입찰 기간: 2025-12-15 ~ 2025-12-31 │ │
│ │ 게시 기간: 2026-01-01 ~ 2026-01-31 │ │
│ │ 상태: 입찰 진행 중                  │ │
│ │ 최소: 10,000원 | 최대: 100,000원   │ │
│ │                                     │ │
│ │ 내 입찰: 50,000원 (등록 완료)      │ │
│ │ [입찰 수정] [입찰 취소]            │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [다음 입찰 예정]                        │
│ ┌─────────────────────────────────────┐ │
│ │ 알뜰폰 (MVNO) - 2월                │ │
│ │ 입찰 기간: 2026-01-15 ~ 2026-01-31 │ │
│ │ 게시 기간: 2026-02-01 ~ 2026-02-28 │ │
│ │ 상태: 입찰 예정 (2026-01-15 시작)  │ │
│ │ 최소: 10,000원 | 최대: 100,000원   │ │
│ │                                     │ │
│ │ [입찰 예약] (입찰 시작 전까지 대기)│ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [종료된 입찰]                           │
│ ┌─────────────────────────────────────┐ │
│ │ 알뜰폰 (MVNO) - 12월               │ │
│ │ 입찰 기간: 2025-11-15 ~ 2025-11-30 │ │
│ │ 게시 기간: 2025-12-01 ~ 2025-12-31 │ │
│ │ 상태: 종료                          │ │
│ │ 내 입찰: 50,000원 (낙찰 ✅)        │ │
│ │ 게시물: 상품 #123 (1위 노출)       │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 🔍 판매자 혼동 방지 UI/UX

### 1. 명확한 시각적 구분

#### 상태별 색상/아이콘
- **진행 중 (bidding)**: 파란색 배경, "입찰 진행 중" 라벨
- **게시 중 (displaying)**: 초록색 배경, "게시 중" 라벨
- **예정 (upcoming)**: 회색 배경, "입찰 예정" 라벨
- **종료 (finished)**: 회색 배경, "종료됨" 라벨

#### 카드 구조
```
┌─────────────────────────────────────┐
│ [카테고리] [월] [상태 배지]         │
│                                     │
│ 입찰 기간: YYYY-MM-DD ~ YYYY-MM-DD │
│ 게시 기간: YYYY-MM-DD ~ YYYY-MM-DD │
│                                     │
│ 금액 범위: 최소 ~ 최대 원           │
│                                     │
│ [내 입찰 정보 또는 액션 버튼]      │
└─────────────────────────────────────┘
```

### 2. 시간 정보 강조

#### 표시 형식
```
입찰 기간:
  시작: 2025-12-15 00:00:00
  종료: 2025-12-31 23:59:59
  남은 시간: 15일 12시간 30분

게시 기간:
  시작: 2026-01-01 00:00:00
  종료: 2026-01-31 23:59:59
  게시 예정까지: 16일 12시간 30분
```

### 3. 상태별 액션 구분

#### 진행 중 (bidding)
- 입찰 참여 / 입찰 수정 / 입찰 취소
- "현재 입찰 진행 중" 안내

#### 예정 (upcoming)
- 입찰 예약 불가 (입찰 시작 전)
- "입찰 시작 알림 받기" 옵션

#### 게시 중 (displaying)
- 입찰 불가 (입찰 종료됨)
- "게시 중 - 다음 입찰 준비" 안내

#### 종료 (finished)
- 입찰 정보 조회만 가능
- 낙찰 결과 및 게시물 정보 표시

---

## 📊 데이터 구조 예시

### 연속 입찰 라운드 데이터

```sql
-- 12월 입찰 라운드 (게시 중)
id: 1
category: 'mvno'
bidding_start_at: '2025-11-15 00:00:00'
bidding_end_at: '2025-11-30 23:59:59'
display_start_at: '2025-12-01 00:00:00'
display_end_at: '2025-12-31 23:59:59'
status: 'displaying'
created_at: '2025-11-01 00:00:00'

-- 1월 입찰 라운드 (입찰 진행 중)
id: 2
category: 'mvno'
bidding_start_at: '2025-12-15 00:00:00'
bidding_end_at: '2025-12-31 23:59:59'
display_start_at: '2026-01-01 00:00:00'
display_end_at: '2026-01-31 23:59:59'
status: 'bidding'
created_at: '2025-11-20 00:00:00'

-- 2월 입찰 라운드 (예정)
id: 3
category: 'mvno'
bidding_start_at: '2026-01-15 00:00:00'
bidding_end_at: '2026-01-31 23:59:59'
display_start_at: '2026-02-01 00:00:00'
display_end_at: '2026-02-28 23:59:59'
status: 'upcoming'
created_at: '2025-12-01 00:00:00'
```

---

## 🔄 자동 전환 프로세스

### 1. 입찰 종료 → 게시 시작

```
시점: 2026-01-01 00:00:00

1. 12월 라운드 (id=1):
   - status: 'displaying' → 'finished'
   - 게시물: bidding_product_assignments에서 제거
   - 상품: 일반 게시물로 전환 (created_at 기준 정렬)

2. 1월 라운드 (id=2):
   - status: 'closed' → 'displaying' (낙찰 처리 완료 후)
   - 게시물: bidding_product_assignments에 있는 상품 상단 노출
   - 상품: 입찰 금액 순으로 1~20위 배치
```

### 2. 입찰 시작

```
시점: 2025-12-15 00:00:00

1월 라운드 (id=2):
- status: 'upcoming' → 'bidding'
- 입찰 참여 가능
```

---

## 💡 판매자 혼동 방지 전략

### 1. 명확한 라벨링

```
[진행 중] 알뜰폰 1월 입찰
  → 현재 입찰할 수 있는 라운드

[예정] 알뜰폰 2월 입찰
  → 다음 입찰 (아직 시작 안 됨)

[종료] 알뜰폰 12월 입찰
  → 이미 종료된 라운드
```

### 2. 시간 정보 명확화

```
진행 중인 입찰:
  입찰 마감까지: 15일 12시간
  게시 시작: 2026-01-01 00:00

다음 입찰 예정:
  입찰 시작: 2026-01-15 00:00
  게시 시작: 2026-02-01 00:00
```

### 3. 내 입찰 현황 표시

```
[진행 중] 알뜰폰 1월 입찰
  내 입찰: 50,000원
  상태: 입찰 참여 완료
  마감까지: 15일

[종료] 알뜰폰 12월 입찰
  내 입찰: 50,000원
  상태: 낙찰 ✅
  게시물: 상품 #123 (1위 노출 중)
  게시 종료: 2025-12-31 23:59
```

### 4. 필터 및 정렬

```
필터 옵션:
- 전체
- 입찰 가능 (bidding)
- 게시 중 (displaying)
- 종료됨 (finished)

정렬:
- 입찰 시작일 기준 (가까운 순)
- 입찰 종료일 기준
- 게시 시작일 기준
```

---

## ⚠️ 주의사항

### 1. 중복 입찰 방지

판매자는 같은 카테고리에서:
- 현재 입찰 진행 중인 라운드: 1개만 참여 가능
- 다음 입찰 라운드: 아직 참여 불가 (시작 전)

### 2. 입찰 기간과 게시 기간 겹침

```
12월 입찰: 2025-11-15 ~ 2025-11-30
12월 게시: 2025-12-01 ~ 2025-12-31

1월 입찰: 2025-12-15 ~ 2025-12-31 (12월 게시 중에 입찰 시작)
1월 게시: 2026-01-01 ~ 2026-01-31
```

→ 12월 15일~31일: 12월 게시 중이면서 동시에 1월 입찰 진행 중

### 3. 게시물 전환 시점

```
2025-12-31 23:59:59: 12월 게시물 상단 노출
2026-01-01 00:00:00: 1월 게시물 상단 노출로 전환
```

→ 자동 전환 (배치 작업)

---

## 🎨 UI/UX 개선 제안

### 1. 타임라인 뷰

```
[12월 입찰] ────[12월 게시]────[종료]
                     │
              [1월 입찰 시작]
                     │
              [1월 입찰 진행]───[1월 게시]───
```

### 2. 달력 뷰

```
        2025년 12월             2026년 1월
┌─────────────────────┐  ┌─────────────────────┐
│ 12월 게시 중         │  │ 1월 입찰 진행 중    │
│ (12/1 ~ 12/31)      │  │ (1/15 ~ 1/31)       │
│                     │  │                     │
│ [1월 입찰 참여 가능]│  │ [1월 입찰 참여 중] │
└─────────────────────┘  └─────────────────────┘
```

### 3. 알림 기능

```
- 입찰 마감 3일 전 알림
- 입찰 시작 알림
- 낙찰 결과 알림
- 게시 시작 알림
```

---

## 📝 요약

1. **연속 입찰 시스템**: 월별로 연속적으로 입찰 라운드 진행
2. **자동 전환**: 게시 종료 시 자동으로 finished, 게시 시작 시 displaying 전환
3. **명확한 구분**: 상태별로 시각적으로 구분하여 판매자 혼동 방지
4. **시간 정보 강조**: 입찰 기간, 게시 기간, 남은 시간 명확히 표시
5. **중복 참여 방지**: 같은 카테고리에서 진행 중인 입찰은 1개만 참여 가능

