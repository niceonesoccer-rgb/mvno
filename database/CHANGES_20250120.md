# 광고 시스템 변경사항 (2025-01-20)

## 변경사항 요약

### 1. 입금 신청 상태 변경

**변경 전:**
- 상태: pending, confirmed, rejected, cancelled, unpaid

**변경 후:**
- 상태: pending, confirmed, unpaid (거부됨 상태 제거)
- **pending**: 대기중
- **confirmed**: 입금 (입금 확인 완료)
- **unpaid**: 미입금 (3일 경과 후 자동 분류)

**영향받는 파일:**
- `database/rotation_advertisement_schema.sql` (deposit_requests 테이블)
- `database/TAX_INVOICE_SYSTEM_DESIGN.md`
- `admin/deposit/requests.php` (필터 옵션)

---

### 2. 세금계산서 발행 - 빠른 기간 선택 추가

**추가 기능:**
- 기간 설정 옆에 "이번달", "지난달" 버튼 추가
- **이번달**: 이번 달 1일 ~ 오늘
- **지난달**: 지난 달 1일 ~ 지난 달 마지막일

**영향받는 파일:**
- `admin/tax-invoice/issue.php` (UI 추가)
- `database/TAX_INVOICE_SYSTEM_DESIGN.md`

---

### 3. 세금계산서 발행 내역 상태 변경

**변경 전:**
- 상태: issued, cancelled

**변경 후:**
- 상태: issued, unissued, cancelled
- **issued**: 발행
- **unissued**: 미발행 (기본값)
- **cancelled**: 취소

**영향받는 파일:**
- `database/rotation_advertisement_schema.sql` (tax_invoices 테이블)
- `database/TAX_INVOICE_SYSTEM_DESIGN.md`
- `admin/tax-invoice/list.php` (필터 옵션)

---

### 4. 광고 재신청 시 이력 관리

**추가 요구사항:**
- 광고 종료된 상품을 다시 광고할 경우, 새로운 광고로 등록됨
- 모든 광고 내역이 시간순서대로(created_at 기준) 표시됨
- 같은 상품에 대해 여러 번 광고를 신청한 경우, 모든 이력이 순서대로 관리됨

**영향받는 파일:**
- `database/ROTATION_ADVERTISEMENT_FINAL_DESIGN.md`
- `seller/advertisement/list.php` (광고 목록 정렬)

---

## 데이터베이스 스키마 변경

### deposit_requests 테이블

```sql
-- 변경 전
status ENUM('pending', 'confirmed', 'rejected', 'cancelled', 'unpaid')

-- 변경 후
status ENUM('pending', 'confirmed', 'unpaid')
```

### tax_invoices 테이블

```sql
-- 변경 전
status ENUM('issued', 'cancelled') NOT NULL DEFAULT 'issued'

-- 변경 후
status ENUM('issued', 'unissued', 'cancelled') NOT NULL DEFAULT 'unissued'
```

---

## 마이그레이션 필요사항

### 1. deposit_requests 테이블 수정

```sql
-- 기존 rejected, cancelled 상태를 처리
-- rejected는 어떻게 처리할지 결정 필요 (pending으로 변경? 삭제?)
-- cancelled는 어떻게 처리할지 결정 필요 (pending으로 변경? 삭제?)

ALTER TABLE deposit_requests 
MODIFY COLUMN status ENUM('pending', 'confirmed', 'unpaid') NOT NULL DEFAULT 'pending' 
COMMENT '상태 (대기중, 입금, 미입금)';
```

### 2. tax_invoices 테이블 수정

```sql
-- 기존 issued 상태는 그대로 유지
-- 새로운 unissued 상태 추가

ALTER TABLE tax_invoices 
MODIFY COLUMN status ENUM('issued', 'unissued', 'cancelled') NOT NULL DEFAULT 'unissued' 
COMMENT '상태 (발행, 미발행, 취소)';
```

---

## UI 변경사항

### admin/deposit/requests.php
- 필터 옵션에서 "거부됨" 제거

### admin/tax-invoice/issue.php
- "이번달", "지난달" 버튼 추가
- JavaScript로 날짜 자동 설정 기능 추가 필요

### admin/tax-invoice/list.php
- 필터 옵션: "발행완료" → "발행", "미발행" 추가

### seller/advertisement/list.php
- 광고 목록을 created_at 기준 내림차순 정렬 (최신순)
- 같은 상품의 여러 광고가 시간순서대로 표시됨

---

## 확인사항

1. ✅ 입금 신청 상태에서 "거부됨" 제거
2. ✅ 세금계산서 발행에 "이번달", "지난달" 버튼 추가
3. ✅ 세금계산서 발행 내역 상태를 "발행", "미발행", "취소"로 변경
4. ✅ 광고 재신청 시 새로 등록되어 이력이 순서대로 관리
